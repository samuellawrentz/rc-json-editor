"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var React=require("react");function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var DataTypes,React__default=_interopDefaultLegacy(React);!function(e){e.string="string",e.number="number",e.boolean="boolean",e.list="list",e.object="object",e.staticList="static list",e.listOfStrings="list of strings",e.listOfNumbers="list of numbers",e.listOfBooleans="list of booleans"}(DataTypes=DataTypes||{});const DefaultValues={string:"",number:0,boolean:!0,list:[],listOfStrings:[""],listOfNumbers:[0],listOfBooleans:[!0],object:{},"list of strings":[""],"list of numbers":[0],"list of booleans":[!0]};class TreeUtils{static convertJSONtoTree(c,u,d="",p=0,f=0){return Object.keys(c).map((e,t)=>{const a=c[e],l=TreeUtils.getType(a),n=Array.isArray(a),s=l===DataTypes.object||l===DataTypes.list,r=(d?d+".":"")+e;var o=n&&!TreeUtils.isAllPrimitive(a);const i=l===DataTypes.object||o?"":a;return{setSubObject:function(){return this.sub_object=s?TreeUtils.convertJSONtoTree(n?TreeUtils.getObjectFromList(a):a,this,r,p+1,t):[],this},key:e,response_key:r,parent:u,parentIndex:f,level:p,response_value:i,selected:!1,originalValue:n?a:void 0,data_type:l,sub_object:[]}.setSubObject()})}static generateNewNode(e){return{key:"",response_value:"",data_type:"string",sub_object:[],path:`${null!=e&&e.path?`${null==e?void 0:e.path}.`:""}key`,level:void 0===(null==e?void 0:e.level)?0:(null==e?void 0:e.level)+1,parent:e}}static isAllPrimitive(e){return e.every(e=>typeof e!==DataTypes.object)}static getPrimitiveArrayType(e){return e.length?"boolean"==typeof e[0]?DataTypes.listOfBooleans:"string"==typeof e[0]?DataTypes.listOfStrings:"number"==typeof e[0]?DataTypes.listOfNumbers:void 0:DataTypes.list}static getType(e){return null==e?"string":Array.isArray(e)?TreeUtils.isAllPrimitive(e)?this.getPrimitiveArrayType(e):DataTypes.list:typeof e===DataTypes.object?DataTypes.object:typeof e}static getObjectFromList(e){return e.reduce((t,a)=>(TreeUtils.getType(a)===DataTypes.object&&Object.keys(a).forEach(e=>{t[e]||(t[e]=a[e])}),t),{})}}function DefaultItemComponent({item:t,siblings:a,idx:l,updateSelection:n,addSubItem:e,updateNodeType:s,removeNode:r,updateKey:o}){return React__default.default.createElement(React__default.default.Fragment,null,React__default.default.createElement("div",{className:"checkbox",style:{transform:`translateX(-${32*t.level}px)`}},React__default.default.createElement("input",{type:"checkbox",checked:t.selected,onChange:e=>n(null==a?void 0:a[l],e.target.checked)})),React__default.default.createElement("div",{className:"add",onClick:()=>e(a,l)},"+"),React__default.default.createElement("div",{className:"key"},React__default.default.createElement("input",{value:t.key,onChange:e=>o(t,e.target.value)})),React__default.default.createElement("div",{className:"type"},React__default.default.createElement("select",{value:t.data_type,style:{width:180},onChange:e=>{s(t,e.target.value)}},React__default.default.createElement("option",{value:"list"},"Array"),React__default.default.createElement("option",{value:"list of strings"},"Array of Strings"),React__default.default.createElement("option",{value:"list of numbers"},"Array of Numbers"),React__default.default.createElement("option",{value:"list of booleans"},"Array of Booleans"),React__default.default.createElement("option",{value:"string"},"String"),React__default.default.createElement("option",{value:"object"},"Object"),React__default.default.createElement("option",{value:"number"},"Number"),React__default.default.createElement("option",{value:"boolean"},"Boolean"))),React__default.default.createElement("div",{className:"remove",onClick:()=>{r(a,l)}},"âž–"))}function styleInject(e,t){var a,l,t=(t=void 0===t?{}:t).insertAt;e&&"undefined"!=typeof document&&(a=document.head||document.getElementsByTagName("head")[0],(l=document.createElement("style")).type="text/css","top"===t&&a.firstChild?a.insertBefore(l,a.firstChild):a.appendChild(l),l.styleSheet?l.styleSheet.cssText=e:l.appendChild(document.createTextNode(e)))}TreeUtils.convertTreetoJSON=e=>e.reduce((t,a)=>{var e,l=null!=(l=a.key)?l:null==(l=a.response_key.match(/\w+$/g))?void 0:l[0];if(t[l]=a.response_value||DefaultValues[a.data_type],null!=(e=null==a?void 0:a.sub_object)&&e.length){let e;e=a.data_type===DataTypes.list?[TreeUtils.convertTreetoJSON(a.sub_object)]:TreeUtils.convertTreetoJSON(a.sub_object),t[l]=e}return t},{}),TreeUtils.transformTree=(e,l,n=0,s=0)=>e.map((e,t)=>{var a;return e.parent=l,e.level=n,e.parentIndex=s,null!=(a=e.sub_object)&&a.length&&(e.sub_object=TreeUtils.transformTree(e.sub_object,e,n+1,t)),e}),TreeUtils.cleanTree=(e,a=!0,l=!1,n=!0)=>e.map(e=>{var t;return e.parent=e.path=e.level=e.parentIndex=e.setSubObject=void 0,a&&(e.response_key=void 0),l&&(e.selected=void 0,e.value=null==e?void 0:e.response_value),n&&(e.response_value=void 0),null!=(t=e.sub_object)&&t.length&&(e.sub_object=TreeUtils.cleanTree(e.sub_object,a,l,n)),e});var css_248z='.schema-editor.default input, .schema-editor.default select {\n  height: 24px;\n  margin: 0;\n  font-size: 16px;\n  padding: 0 4px;\n}\n.schema-editor.default .add {\n  border: 1px solid;\n  width: 24px;\n  height: 24px;\n  display: grid;\n  place-items: center;\n}\n.schema-editor.default .remove, .schema-editor.default .add {\n  cursor: pointer;\n}\n.schema-editor .object {\n  flex-basis: 100%;\n}\n.schema-editor .object .object {\n  margin-left: 32px;\n}\n.schema-editor .object .object .item::before {\n  content: "";\n  position: absolute;\n  display: block;\n  height: calc(100% + 24px);\n  top: 0px;\n  left: 8px;\n  width: 1px;\n  background-color: #000;\n}\n.schema-editor .object .object .item:after {\n  position: absolute;\n  display: block;\n  content: "";\n  width: 16px;\n  height: 1px;\n  background-color: #000;\n  top: 16px;\n  left: 8px;\n}\n.schema-editor .object .object .item:last-child:before {\n  height: 16px;\n}\n.schema-editor .object .item {\n  margin-top: 24px;\n  position: relative;\n  display: flex;\n  column-gap: 16px;\n  align-items: center;\n  flex-wrap: wrap;\n}';styleInject(css_248z);const JsonTree=({data:n,ItemComponent:s,treeMethods:r})=>React__default.default.createElement("div",{className:"object"},n.map((e,t)=>{var a=Object.assign({siblings:n,item:e,idx:t},r),l=React.useMemo(()=>s||DefaultItemComponent,[e]);return React__default.default.createElement(React__default.default.Fragment,{key:t},React__default.default.createElement("div",{className:`item ${null!=(t=e.sub_object)&&t.length?"has-children":""} `+((null==(t=e.parent)?void 0:t.data_type)===DataTypes.staticList?"static-list-item":"")},React__default.default.createElement(l,Object.assign({},a)),!(null==(t=e.sub_object)||!t.length)&&React__default.default.createElement(JsonTree,{data:e.sub_object,ItemComponent:s,treeMethods:r})))})),useTreeHandler=(l,a)=>{const e=React.useCallback(t=>(...e)=>t(...e)||a(l),[]),n=(e,t)=>{null!=e&&e.push(TreeUtils.generateNewNode(t))};const s=(e,a)=>{null!=e&&e.sub_object.forEach(e=>{var t;e.selected=a,null!=(t=null==e?void 0:e.sub_object)&&t.length&&o(e,a)})},r=(e,t)=>{var a;null!=e&&e.parent&&(null!=(a=e.parent)&&a.parent&&r(null==e?void 0:e.parent,t),e.parent.selected=t)};const o=(e,t,a=!1)=>{var l;e&&(e.selected=t),null!=(l=null==e?void 0:e.sub_object)&&l.length&&!a&&s(e,t),t?r(e,!0):e&&e.parent&&!e.parent.sub_object.some(e=>e.selected)&&o(e.parent,!1,!0)};const i=(e,t)=>{Object.assign(e,t)};return{updateSelection:e(o),updateNodeType:e((e,t)=>{e.data_type=t,e.sub_object=[],t===DataTypes.object?e.sub_object=[TreeUtils.generateNewNode(e)]:t===DataTypes.staticList?e.sub_object=TreeUtils.convertJSONtoTree(e.originalValue,e,e.response_key):t===DataTypes.list&&(e.sub_object=TreeUtils.convertJSONtoTree(TreeUtils.getObjectFromList(e.originalValue),e,e.response_key))}),removeNode:e((e,t)=>{null!=e&&e.splice(t,1)}),addSubItem:e((e,t)=>{var a;e&&(e[t].data_type!==DataTypes.list&&(e[t].data_type=DataTypes.object),e[t].response_value="",a=e[t].sub_object,n(a,e[t]))}),addItem:e(n),updateKey:e((e,t)=>{i(e,{key:t})}),updateValue:e((e,t)=>{i(e,{response_value:t})}),selectAll:e(a=>{l.forEach(e=>{var t;e.selected=a,null!=(t=null==e?void 0:e.sub_object)&&t.length&&s(e,a)})}),updateNode:e(i)}},JsonEditor=React.forwardRef(function({data:e,ItemComponent:t,fromTree:a,onChange:l},n){if(!e)return null;a?TreeUtils.transformTree(e,void 0):TreeUtils.convertJSONtoTree(e,void 0);const s=useTreeHandler(e,l);return React.useImperativeHandle(n,()=>({getJson:()=>TreeUtils.convertTreetoJSON([...e]),getTree:()=>[...e],selectAll:s.selectAll,updateSelection:s.updateSelection}),[]),e.length?React__default.default.createElement("div",{className:"schema-editor "+(t?"custom":"default")},React__default.default.createElement(JsonTree,{data:e,ItemComponent:t,treeMethods:s})):null});exports.JsonEditor=JsonEditor,exports.TreeUtils=TreeUtils;
//# sourceMappingURL=index.js.map
